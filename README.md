# RUO - AI 涨停投研分析系统

## 📋 项目介绍

这是一个基于 **LangGraph 多 Agent 工作流 + 通义千问 + AkShare 实时数据** 的 AI 涨停投研分析系统。该系统能够自动生成每日涨停股的分析报告，并提供丰富的数据可视化图表。通过多 Agent 协作，系统能够从多个角度对市场数据进行深入分析，为投资者提供有价值的决策支持。

## ✨ 功能亮点

### 核心功能
- **多 Agent 协作**：数据官、策略师、风控员、短线龙头助手等多个角色协同工作
- **实时数据获取**：使用 AkShare 获取最新的涨停股数据
- **大模型推理**：基于通义千问（Qwen）生成高质量的分析报告
- **本地缓存**：分析结果持久化到本地，支持后续工作流调用历史数据
- **数据可视化**：提供多种图表（饼图、桑基图、气泡图）展示市场数据
- **专业界面**：使用 Streamlit + streamlit-option-menu 构建简洁直观的多页面 Web UI
- **PDF 导出**：支持将分析报告导出为 PDF 格式，便于分享和存档

### 分析功能
- **每日涨停投研分析**：分析指定交易日的涨停股票，生成 AI 投研报告
- **开盘表现分析**：追踪昨日涨停股票的今日开盘表现，分析连板率和持续强度
- **短线龙头助手**：基于龙头战法 6 大维度（题材强度、身位、盘口强度、梯队地位、情绪周期、风险信号）提供操作建议

## 🚀 快速开始

### 方式一：一键启动（推荐）

```bash
# 添加执行权限（首次使用）
chmod +x start_app.py

# 启动应用
./start_app.py
```

该脚本会自动：
- 检查并安装必要依赖
- 检查可选依赖（reportlab）
- 启动 Streamlit 应用
- 在浏览器中打开应用

### 方式二：手动启动

```bash
# 1. 安装依赖
pip install -r requirements.txt
pip install streamlit-option-menu

# 2. 启动 Streamlit 应用
streamlit run main.py
```

### 方式三：Python 启动

```bash
python start_app.py
```

## ⚙️ 环境配置

### 依赖安装

确保你已经安装了 Python 3.8+，然后在项目根目录下运行以下命令安装依赖：

```bash
pip install -r requirements.txt
pip install streamlit-option-menu  # 导航菜单组件
```

### 环境变量配置

创建一个 `.env` 文件，并添加以下内容：

```env
# 通义千问 API 密钥
DASHSCOPE_API_KEY=your_api_key_here

# 或者使用 OpenAI 格式
OPENAI_API_KEY=your_api_key_here
OPENAI_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1
```

### 可选功能

**PDF 导出功能**：需要安装 reportlab
```bash
pip install reportlab
```

## 📱 界面导航

启动后，在左侧会看到导航菜单：

```
┌────────────────────────┐
│  📈 导航菜单           │
├────────────────────────┤
│  🏠 首页              │  ← 点击切换页面
│  📊 每日涨停分析       │
│  🌅 开盘分析           │
└────────────────────────┘
```

### 🏠 首页

显示系统概览：
- 统计信息（每日投研报告数量、开盘分析报告数量、分析股票总数）
- 最新报告预览（显示最近生成的报告摘要）
- 快速操作按钮（一键跳转到分析页面）

### 📊 每日涨停分析

分析指定交易日的涨停股票：
1. 输入分析日期（格式：YYYY-MM-DD）
2. 点击"🚀 开始涨停分析"
3. 查看 AI 投研核心结论
4. 查看数据可视化图表（概念分布、时间流向、散点图）
5. 可选：导出 PDF 报告
6. 查看历史投研报告
7. 批量导出投研报告

### 🌅 开盘分析

追踪昨日涨停股票的今日开盘表现：
1. 系统自动使用昨日日期（无需手动输入）
2. 点击"🚀 开始开盘分析"
3. 查看开盘表现分析
4. 查看连板率和持续强度
5. 可选：导出 PDF 报告
6. 查看历史开盘分析报告
7. 批量导出开盘分析报告

## 📁 项目结构

```
ruo/
│
├── main.py                     # 主应用文件（Streamlit UI）
├── start_app.py                # 一键启动脚本
├── agent_system.py             # 多 Agent 工作流及缓存逻辑
├── opening_analysis_workflow.py # 开盘分析工作流
├── tools.py                    # 工具函数
├── report_export.py            # PDF 导出工具
├── .env                        # 环境变量配置（需创建）
├── requirements.txt            # 依赖包列表
├── pyproject.toml              # 项目配置
│
├── cache/                      # 缓存目录
│   ├── daily_research/         # 每日投研报告缓存
│   │   └── YYYY-MM-DD/         # 按日期组织的报告
│   │       ├── report.md       # Markdown 报告
│   │       ├── state.json      # 状态数据
│   │       └── raw_data.pkl    # 原始数据
│   └── opening_analysis/       # 开盘分析报告缓存
│       └── YYYY-MM-DD/        # 按日期组织的报告
│           ├── opening_analysis_report.md
│           └── state.json
│
└── reports/                   # 导出的报告
    └── pdf/                    # PDF 导出目录
        ├── 每日投研报告_YYYY-MM-DD.pdf
        └── 开盘分析报告_YYYY-MM-DD.pdf
```

## 📄 PDF 导出功能

### 在 Streamlit 界面中使用

#### 导出单个报告
1. 在 Web 界面中生成或查看报告
2. 在报告内容下方点击 **"📄 导出 PDF 报告"** 按钮
3. 等待生成完成
4. 点击下载按钮保存 PDF 文件

#### 批量导出报告
在对应分析页面的底部：
- **每日涨停分析页面**：批量导出投研报告
- **开盘分析页面**：批量导出开盘分析报告

支持导出方式：
- 导出最近 N 个报告
- 导出所有报告

### 命令行使用

```bash
# 导出最新报告
python3 report_export.py

# 导出指定日期
python3 report_export.py --date 2025-11-28

# 导出最近 5 个报告
python3 report_export.py --latest 5

# 导出所有报告
python3 report_export.py --all
```

### 导出文件位置

所有导出的 PDF 文件保存在：
```
reports/pdf/
├── 每日投研报告_2025-11-27.pdf
├── 每日投研报告_2025-11-28.pdf
└── 开盘分析报告_2025-11-28.pdf
```

## 🎯 核心功能说明

### 多 Agent 工作流

系统采用 LangGraph 构建多 Agent 协作工作流：

1. **数据官**：收集和整理涨停股票数据
2. **策略师**：分析市场趋势和投资策略
3. **风控员**：识别风险信号并提供风控建议
4. **短线龙头助手**：基于龙头战法提供操作建议，包括：
   - 梯队地位（龙头/跟风/独立）
   - 情绪周期（冰点/回暖/主升/高潮/退潮）
   - 操作建议（可打板/关注/观望/回避）
   - 买点描述
   - 止损价和目标价
   - 风险信号
   - 风险收益比

### 输出字段说明

短线龙头助手建议包含以下字段：
- `code`: 股票代码
- `name`: 股票名称
- `tier_rank`: 梯队地位（带动家数=今日同概念涨停数，龙头/跟风/独立）
- `mood_cycle`: 情绪周期（当前为冰点/回暖/主升/高潮/退潮，该票是否共振转折）
- `action`: 操作建议（"可打板"/"关注"/"观望"/"回避"）
- `entry_point`: 买点描述
- `stop_loss`: 止损价
- `take_profit`: 目标价
- `risk_signal`: 风险信号（巨量(>30%)｜长阴｜跌破 5 日线｜后排跌停≥3 家｜监管问询）
- `risk_reward_ratio`: 风险收益比
- `reason`: 逻辑说明（不超过30字）

## 🔧 故障排除

### 问题1：依赖安装失败

**现象**：`ModuleNotFoundError: No module named 'xxx'`

**解决**：
```bash
# 使用启动脚本自动安装
./start_app.py

# 或手动安装
pip install -r requirements.txt
pip install streamlit-option-menu
```

### 问题2：streamlit-option-menu 未找到

**解决**：
```bash
pip install streamlit-option-menu
```

### 问题3：应用无法启动

**解决**：
```bash
# 检查 Python 版本（需要 3.8+）
python --version

# 手动启动
streamlit run main.py
```

### 问题4：中文显示问题

**解决**：确保系统已安装中文字体
- macOS：系统自带苹方字体
- Windows：系统自带微软雅黑
- Linux：需要安装中文字体包

### 问题5：PDF 导出中文显示为方框

**解决**：
- macOS：系统通常自带苹方字体，无需额外操作
- Windows：确保安装了微软雅黑或宋体
- Linux：需要安装中文字体包（如 `fonts-wqy-zenhei`）

## 📝 功能规划

### 短期规划

1. **用户登录系统**
   - 添加用户登录功能，记录用户的分析历史和个人偏好
   - 支持用户保存和分享个人分析报告

2. **移动端 H5 页面**
   - 开发移动端适配的 H5 页面，方便用户在手机上查看和操作

3. **语音播报版本**
   - 将每日分析报告转换为语音，支持语音播报功能

4. **自动回测**
   - 添加自动回测功能，验证分析结果的有效性
   - 提供历史数据回溯分析，帮助用户优化策略

### 中期规划

1. **微信推送晨报**
   - 集成微信推送功能，每天早上自动发送最新分析报告给用户

2. **Web API 服务化**
   - 将分析功能封装为 RESTful API，支持外部系统调用
   - 提供 API 文档和示例代码

3. **RAG 查询系统**
   - 使用向量化存储和 FAISS 实现 RAG 查询系统，支持基于历史报告的快速检索
   - 结合 LLM 进行上下文理解和生成回答

4. **记忆进化机制**
   - 对比多日表现，调整策略权重，实现更智能的决策建议

### 长期规划

1. **高级分析工具**
   - 提供更多的高级分析工具，如资金流向分析、行业趋势预测等
   - 集成更多第三方数据源，丰富分析维度

2. **AI 打板成功率排行榜**
   - 根据历史数据分析，生成 AI 打板成功率排行榜
   - 提供个性化推荐，帮助用户找到最适合自己的打板策略

## 📊 更新日志

### v3.1.0 (2025-11-28)
- ✅ 功能布局优化（历史报告查看和批量导出移至对应页面）
- ✅ 侧边栏简化，只保留导航和使用指南
- ✅ 功能与页面聚合，操作更直观

### v3.0.0 (2025-11-28)
- ✅ 使用 streamlit-option-menu 优化界面
- ✅ 创建专业侧边导航菜单
- ✅ 模块化页面结构（首页/每日分析/开盘分析）
- ✅ 统一的侧边栏组件
- ✅ 添加一键启动脚本
- ✅ 优化用户体验

### v2.0.0 (2025-11-28)
- ✅ 集成开盘分析功能
- ✅ 优化 Streamlit 界面布局
- ✅ PDF 导出功能
- ✅ 增强历史记录管理
- ✅ 短线龙头助手功能完善

### v1.0.0 (2025-11-27)
- ✅ AI 多智能体工作流
- ✅ 每日涨停分析功能
- ✅ 基础可视化图表
- ✅ 缓存管理

## 📄 许可证

本项目采用 MIT 许可证，详情请参阅 [LICENSE](LICENSE) 文件。

---

如果你有任何问题或建议，请随时联系我。希望这个项目能为你带来帮助！🚀
