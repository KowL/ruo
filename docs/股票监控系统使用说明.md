# 股票监控系统使用说明

## 系统概述

股票监控系统是一个基于 Python 的自动化股票监控工具，支持实时监控股票价格波动，并提供 AI 驱动的投资建议。系统特别针对中国 A 股市场进行了优化，集成了技术指标分析和智能决策功能。

## 主要功能

### 1. 实时价格监控
- 自动获取股票实时价格
- 计算价格波动幅度
- 支持中国 A 股和美股

### 2. 技术指标分析
- **MA 均线分析**：MA5、MA20 均线趋势
- **RSI 指标**：超买超卖判断
- **MACD 指标**：趋势动量分析
- **成交量分析**：量能变化监控
- **综合技术评分**：0-100 分制评分

### 3. AI 智能分析
- 基于大语言模型的投资建议
- 支持多种 LLM 提供商（阿里百炼、OpenAI 等）
- 提供买入/卖出/持有建议
- 置信度评估

### 4. 数据库管理
- SQLite 数据库存储
- 价格历史记录
- 持仓信息管理

## 系统架构

```
ruo/
├── task/stock_monitor.py    # 主监控程序
├── tradingagents/           # 核心模块
│   ├── llm_adapters/       # LLM 适配器
│   ├── dataflows/          # 数据流处理
│   └── default_config.py   # 默认配置
├── config/                  # 配置文件
├── logs/                   # 日志文件
└── ruo.db                 # SQLite 数据库
```

## 安装和运行

### 1. 环境要求
- Python 3.10+
- uv 包管理器

### 2. 安装依赖
```bash
uv sync
```

### 3. 运行系统
```bash
uv run task/stock_monitor.py
```

## 数据库管理

### 数据库结构

#### stock_hold 表（持仓信息）
| 字段 | 类型 | 说明 |
|------|------|------|
| stock | TEXT | 股票代码（主键） |
| name | TEXT | 股票名称 |
| hold_num | INTEGER | 持仓数量 |
| available | INTEGER | 可用数量 |
| cost | REAL | 成本价格 |

#### stock_prices 表（价格历史）
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 自增主键 |
| stock | TEXT | 股票代码 |
| timestamp | DATETIME | 时间戳 |
| price | REAL | 价格 |

### 常用数据库操作

#### 查看持仓
```bash
sqlite3 ruo.db "SELECT * FROM stock_hold;"
```

#### 添加股票
```bash
sqlite3 ruo.db "INSERT INTO stock_hold (stock, name, hold_num, available, cost) VALUES ('股票代码', '股票名称', 持仓数量, 可用数量, 成本价);"
```

#### 修改持仓
```bash
sqlite3 ruo.db "UPDATE stock_hold SET hold_num = 新数量, cost = 新成本价 WHERE stock = '股票代码';"
```

#### 删除股票
```bash
sqlite3 ruo.db "DELETE FROM stock_hold WHERE stock = '股票代码';"
sqlite3 ruo.db "DELETE FROM stock_prices WHERE stock = '股票代码';"
```

## 配置说明

### 默认配置参数
```python
DEFAULT_CONFIG = {
    'fluctuation_threshold': 2.0,  # 触发AI分析的波动阈值（百分比）
    'monitor_interval': 30,        # 监控间隔（秒）
    'db_path': 'ruo.db',          # 数据库路径
    'enable_notifications': True,  # 启用通知
    'llm_provider': 'dashscope',  # LLM提供商
    'quick_think_llm': 'qwen-turbo', # 快速思考模型
    'deep_think_llm': 'qwen-plus',   # 深度思考模型
}
```

### 配置文件
系统支持从 `config/stock_monitor.json` 加载自定义配置。

## 技术指标说明

### 1. MA 均线信号
- **bullish**：价格在均线上方，看涨
- **weak_bullish**：短期均线在长期上方
- **bearish**：价格在均线下方，看跌
- **weak_bearish**：短期均线在长期下方

### 2. RSI 信号
- **overbought**：RSI > 70，超买
- **oversold**：RSI < 30，超卖
- **bullish**：RSI > 50，看涨
- **bearish**：RSI < 50，看跌

### 3. MACD 信号
- **bullish**：MACD > 0，看涨
- **bearish**：MACD < 0，看跌

### 4. 成交量信号
- **high**：成交量 > 5日均量 × 1.5
- **low**：成交量 < 5日均量 × 0.5
- **normal**：正常成交量

## AI 分析功能

### 支持的 LLM 提供商
- **阿里百炼**（默认）：qwen-turbo, qwen-plus
- **OpenAI**：GPT 系列
- **Anthropic**：Claude 系列
- **Google**：Gemini 系列

### AI 分析触发条件
- 价格波动超过设定阈值（默认 2%）
- 技术指标出现异常信号
- 成交量异常放大

### AI 建议格式
```json
{
    "action": "Buy/Sell/Hold",
    "reason": "分析理由",
    "confidence": "置信度0-100",
    "technical_score": "技术评分"
}
```

## 日志系统

### 日志级别
- **INFO**：正常运行信息
- **WARNING**：警告信息
- **ERROR**：错误信息

### 日志文件
- 位置：`logs/stock_monitor.log`
- 同时输出到控制台和文件

## 当前持仓示例

```
002401|中远海科|1000|2800|1000.0
600438|通威股份|600|600|26.33
300687|赛意信息|1200|0|34.371
002553|南方精工|900|900|25.001
```

## 故障排除

### 常见问题

1. **模块导入错误**
   - 确保在项目根目录运行
   - 检查 Python 路径设置

2. **数据库连接错误**
   - 检查数据库文件权限
   - 确保数据库文件存在

3. **网络请求限制**
   - 调整监控间隔
   - 检查网络连接

4. **LLM 初始化失败**
   - 检查 API 密钥配置
   - 验证网络连接

### 调试模式
可以通过修改日志级别来启用详细调试信息：
```python
logging.basicConfig(level=logging.DEBUG)
```

## 扩展功能

### 1. 通知系统
- 邮件通知
- 微信通知
- 钉钉通知

### 2. 回测功能
- 历史数据回测
- 策略验证

### 3. 风险管理
- 止损止盈
- 仓位管理

## 更新日志

### v1.0.0
- 基础监控功能
- AI 分析集成
- 技术指标分析
- 数据库管理

## 技术支持

如有问题，请检查：
1. 日志文件中的错误信息
2. 数据库连接状态
3. 网络连接情况
4. API 密钥配置

---

*最后更新：2025-08-05* 